id: control.policy_enforce
version: 2.0.0
entrypoint: blocks/processing/control/policy_enforce.py:PolicyEnforceBlock
description: Policy-as-Codeによる自動ポリシー検証と違反検知

inputs:
  data:
    type: object
    description: 検証対象データ
    properties:
      transaction_data:
        type: object
        description: 取引データ
      metadata:
        type: object
        description: メタデータ
    required: [transaction_data]

  policy_config:
    type: object
    description: ポリシー設定
    properties:
      policy_ids:
        type: array
        description: 適用するポリシーIDリスト
        items:
          type: string
      policy_type:
        type: string
        description: ポリシータイプ（すべて適用する場合）
        enum: [compliance, business_rule, security, financial, operational, audit]
      department:
        type: string
        description: 部署別ポリシー適用
      fail_on_violation:
        type: boolean
        description: 違反時に処理を停止するか
        default: false
      severity_threshold:
        type: string
        description: 違反時停止の重要度閾値
        enum: [critical, high, medium, low, info]
        default: critical
    required: []

outputs:
  policy_result:
    type: object
    description: ポリシー検証結果
    properties:
      success:
        type: boolean
        description: 検証成功フラグ
      policies_evaluated:
        type: integer
        description: 評価されたポリシー数
      total_violations:
        type: integer
        description: 総違反数
      critical_violations:
        type: integer
        description: 重要違反数
      violations:
        type: array
        description: 違反詳細リスト
        items:
          type: object
      execution_time_ms:
        type: number
        description: 実行時間（ミリ秒）
      evidence_id:
        type: string
        description: 証跡ID

  violation_summary:
    type: object
    description: 違反サマリ
    properties:
      violation_count_by_severity:
        type: object
        description: 重要度別違反数
      violation_count_by_type:
        type: object
        description: タイプ別違反数
      affected_policies:
        type: array
        description: 違反があったポリシー一覧
        items:
          type: string

error_handling:
  retry_count: 1
  timeout_seconds: 30

evidence_retention:
  days: 2555  # 7年間保存

tags:
  - policy
  - compliance
  - control
  - verification
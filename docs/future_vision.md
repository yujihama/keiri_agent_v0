# Keiri Agent 将来像（Vision）

本ドキュメントは、Keiri Agent の「このツールならでは」の将来像を、特定ドメインに依存しない抽象度で描きつつ、監査・内部監査・内部統制の専門家が展開する前提での方向性を示す。既存のLLMオーケストレーションツールの一般論ではなく、当ツールの設計思想（宣言的Plan、ブロック仕様の型安全、UIの永続、フォールバック禁止、Dry-run前提）を土台とした差別化を明確にする。

## 本ツールならではの価値（Differentiators）

- 宣言的Plan as Contract: `block_specs/*.yaml` のI/O契約と `designs/*.yaml` のPlanによって、業務フローを「暗黙のコード」ではなく「検証可能な契約」として扱う。
- Evidence-first Runtime: `runs/<plan>/<timestamp>.jsonl` の構造化ログを中心に、入出力スナップショット・参照解決の痕跡・ポリシー適用結果を「証跡」として残す。
- UIの一元化と永続: `ui.interactive_input` を中核とし、Session Stateで画面再描画でも値と描画を保持。入力確定前は依存ノードを走らせないため、準同期待ちの誤実行を抑止。
- 型安全LLM: LLMは構造化出力・Pydantic検証で受領。Plan生成もブロックカタログに制約され、I/O整合を通らないと保存・実行できない。
- フォールバック禁止の透明性: 失敗はUIに構造化エラーで提示。黙殺・自動代替をしないため、信頼性と監査可能性が高い。
- 実行制御の厳格化: DAG・when・foreach/while・サブフローを持つ一方、未解決参照は実行延期またはスキップし、順序・型・参照整合を担保する。

## 将来像の柱（Pillars）

1. Assurance-grade Automation Graph
   - 実行グラフと入出力、意思決定（when/条件）の全てを「証跡可能な構造」に固定。
   - 監査・内部統制のレビューに耐える再現性、非否認性（non-repudiation）、改ざん検知を標準機能化。

2. Plan as Evidence（Plan＝証跡）
   - Plan自体が統制設計の成果物であり、実行結果の証憑インデックスのルートとなる。
   - Planのバージョン・署名・差分が、実行証跡と1対1で突合可能。

3. Policy-as-Code × 型安全
   - 組織ポリシー（閾値、承認フロー、サンプリング率、SoD等）をYAMLで宣言し、静的検証＋動的適用。
   - 例外は明示的承認と記録がなければ通らない。

4. LLM Sandboxing & Determinism
   - LLM出力は必ずスキーマ検証・サニタイズを通過。プロンプトや補助文脈も実行ログに要約記録。
   - 重要処理では決定論的生成（temperature=0/参照拘束/few-shot固定）とリプレイを支援。

5. Evidence Supply Chain（証跡サプライチェーン）
   - 証跡ファイルの由来（provenance）・ハッシュ・タイムスタンプ・責任者・承認経路を連結したメタを維持。
   - 外部データソース/API/ファイル入手～Excel出力までの来歴を可視化。

6. Trustworthy Marketplace
   - ブロック/Planの「検証済みパッケージ」を共有。署名・互換性・品質基準を満たしたもののみ「認証済み」として流通。

## 将来の主要機能コンセプト

- 実行アテステーション（Attestation）
  - Plan・ブロック仕様・実行ログ・出力を束ねたマニフェストを生成し、ハッシュと署名で封緘。
  - 監査用に第三者検証可能な最小情報セット（計算再現用シード・モデル識別子・温度・依存ライブラリハッシュ等）を保持。
  - 実行エントリのHMAC署名とマニフェスト整合性検証を標準化。

- Evidence Vault（証跡金庫）
  - 証跡の暗号化保存（AES-256/Fernet）、ハッシュ検証、改ざん検知、保存期間とリーガルホールド。
  - 監査証跡（Audit Trail）とデータ系譜（Lineage）の生成・閲覧・検索APIを提供。
  - Vault索引・タグ・関連証跡リンクにより、証跡ナビゲーションと再現性を強化。

- Policy-as-Code（組織ポリシーの宣言と拘束）
  - `designs/policies/*.yaml` による階層ポリシー（組織/部門/規制）定義、例外承認、適用範囲の宣言。
  - `policy.validate`, `policy.deploy`, `policy.audit` ブロックでPlan/DAGに拘束的に適用、違反は構造化で証跡化。
  - UI/Runにおける適用履歴とコンプライアンススコアを可視化。

- Control Blocks（統制ブロック）
  - 基本: `control.approval`（多段承認）、`control.sod_check`（職務分掌）、`control.sampling`（サンプリング）。
  - 拡張: `control.reconciliation`, `control.validation`, `control.audit_trail` など。
  - Planに統制設計を組み込み、設計–実行–証跡を一体管理。

- Continuous Control Monitoring（CCM）
  - 定期/随時のPlanスケジューリング、逸脱検知、アラート、ドリフト検出。
  - 閾値やルール変更の影響評価（過去Runへの再適用シミュレーション）。

- Reviewer Workspace（レビューワークスペース）
  - 監査/内部監査向けのワークスペース（ダッシュボード、監査レビュー、証跡管理、ポリシー確認、レポート生成の5タブ）。
  - Evidence Vault/Policy-as-Codeと統合し、差分・証跡ナビ・指摘管理・再実行を2クリック以内に到達可能に。

## 他LLMツールとの明確な差

- 「便利な自動化」ではなく「監査可能な自動化」。フォールバックや黙示的補正をしない設計。
- 画面の都度初期化や一過性のプロンプト実行ではなく、Plan/DAGと型で拘束した再現可能な実行。
- LLMは業務設計補助であり、自由生成ではなくカタログ制約下での合成。出力を必ず検証してから流す。

## 非目標（Non-goals）

- ブラックボックスの自律最適化（説明性を欠く自動修正）。
- ログを残さない即時実行（証跡不十分）。
- 無制限のモデル依存（モデル移行性の低下）。

## 監査・内部統制の専門家が展開する前提での価値

- 設計レビューの作業対象を「Plan/BlockSpec」と「実行証跡」に集約。サンプリングと差分比較が容易。
- ポリシー・統制・証跡がYAML/JSONで構造化され、レビュー・再実行・再現が可能。
- 組織内のベストプラクティスPlan/ブロックを再利用し、品質の平準化と審査時間短縮を実現。


